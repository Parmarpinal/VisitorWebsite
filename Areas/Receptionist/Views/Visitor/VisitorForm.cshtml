@model VisitorWebsite.Areas.Receptionist.Models.VisitorModel;

<section class="section">
    <div class="row">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Visitor Form</h5>

                    <!-- Multi Columns Form -->
                    <form class="row g-3" method="post" asp-area="Receptionist" asp-controller="Visitor" asp-action="Save">
                        <div class="col-md-6">
                            <label asp-for="UserID">User Name</label>
                            <select class="form-select" id="UserID" asp-for="UserID" onchange="setVisitorName()">
                                <option value="">Select User</option>
                                @foreach (var v in ViewBag.UserList)
                                {
                                    <option value="@v.UserID" data-username="@v.UserName">@v.UserName</option>
                                }
                            </select>
                            <span asp-validation-for="UserID" class="text-danger"></span>
                        </div>
                        <!-- Hidden input for VisitorName -->
                        <input type="hidden" id="VisitorName" name="VisitorName" asp-for="VisitorName" />
                        @* <div class="col-md-6">
                            <label asp-for="OrganizationID">Organization Name</label>
                            <select class="form-select" id="OrganizationID" asp-for="OrganizationID">
                                <option value="">Select organization</option>
                                @foreach (var v in ViewBag.OrganizationList)
                                {
                                    <option value="@v.OrganizationID">@v.OrganizationName</option>
                                }
                            </select>
                            <span asp-validation-for="OrganizationID" class="text-danger"></span>
                        </div> *@
                        <div class="col-md-6">
                            <label asp-for="DepartmentID">Department Name</label>
                            <select class="form-select" id="DepartmentID" asp-for="DepartmentID">
                                <option value="">Select Department</option>
                                @foreach (var v in ViewBag.DepartmentList)
                                {
                                    <option value="@v.DepartmentID">@v.DepartmentName</option>
                                }
                            </select>
                            <span asp-validation-for="DepartmentID" class="text-danger"></span>
                        </div>
                        <div class="col-12">
                            <label asp-for="Purpose" class="form-label">Purpose</label>
                            <input type="text" class="form-control" asp-for="Purpose">
                            <span asp-validation-for="Purpose" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="HostID">Host Name</label>
                            <select class="form-select" id="HostID" asp-for="HostID">
                                <option value="">Select Host</option>
                            </select>
                            <span asp-validation-for="HostID" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="NoOfPerson" class="form-label">No. of person</label>
                            <input type="text" class="form-control" asp-for="NoOfPerson">
                            <span asp-validation-for="NoOfPerson" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="IDProof" class="form-label">ID Proof</label>
                            <input type="text" class="form-control" asp-for="IDProof">
                            <span asp-validation-for="IDProof" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="IDProofNumber" class="form-label">ID Proof number</label>
                            <input type="text" class="form-control" asp-for="IDProofNumber">
                            <span asp-validation-for="IDProofNumber" class="text-danger"></span>
                        </div>
                        <div class="text-center">
                            <input type="submit" class="btn btn-primary" value="Submit">
                            <button type="reset" class="btn btn-secondary">Reset</button>
                        </div>
                    </form>

                </div>
            </div>
        </div>
        <div class="col-lg-6">

            <div class="card container">
                <div class="card-body d-flex flex-column align-items-center">
                    <div class="row mb-4 mt-3">
                        <div class="col">
                            @* <div style="border:2px solid #A2A2CE;width:200px;height:200px;" class="rounded-circle">
                                <img src="~/assets/img/profile-img.jpg" style="object-fit:cover" />
                            </div> *@
                            <div style="width:120px; height:120px ;border-radius:100px; display: flex; justify-content: center; align-items: center;box-shadow:0px 0px 20px darkslateblue">
                                <img src="~/img/profile.jpg" alt="Profile-Picture" id="userImage" class="rounded-circle" style="width:120px; height:120px">
                            </div>
                        </div>                      
                    </div>
                    <div class="row">
                        <div class="col" style="color:darkslateblue; font-size:17px; font-weight:600">
                            <div class="row mb-2">
                                <div class="col-4">
                                    User Name
                                </div>
                                <div class="col">:</div>
                                <div class="col-6 user-name">
                                    ----
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-4">
                                    Age
                                </div>
                                <div class="col">:</div>
                                <div class="col-6 user-age">
                                    ----
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-4">
                                    Email
                                </div>
                                <div class="col">:</div>
                                <div class="col-6 user-email">
                                    ----
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-4">
                                    Mobile number
                                </div>
                                <div class="col">:</div>
                                <div class="col-6 user-mobile">
                                    ----
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-4">
                                    Gender
                                </div>
                                <div class="col">:</div>
                                <div class="col-6 user-gender">
                                    ----
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-4">
                                    City
                                </div>
                                <div class="col">:</div>
                                <div class="col-6 user-city">----</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-4">
                                    Joining date
                                </div>
                                <div class="col">:</div>
                                <div class="col-6 user-joining-date">----</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts{
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>

    <script>
        function setVisitorName() {
            var userDropdown = document.getElementById("UserID");
            var selectedOption = userDropdown.options[userDropdown.selectedIndex];
            var visitorName = selectedOption.getAttribute("data-username");
            document.getElementById("VisitorName").value = visitorName;
        }

        $(document).ready(function () {
            // $("#OrganizationID").change(function () {
            //     var orgID = $(this).val();
            //     if (orgID) {
            //         $.ajax({
            //             url: '@Url.Action("GetDepartmentByOrganizationID", "Visitor")',
            //             type: "POST",
            //             data: { id: orgID },
            //             success: function (data) {
            //                 $("#DepartmentID").empty().append('<option value="">Select Department</option>');
            //                 $.each(data, function (i, v) {
            //                     $("#DepartmentID").append('<option value="' + v.departmentID + '">' + v.departmentName + '</option>');
            //                 });
            //             },
            //             error: function (xhr, status, error) {
            //                 console.error("Error fetching departments: " + error);
            //             }
            //         });
            //     } else {
            //         $("#DepartmentID").empty().append('<option value="">Select Department</option>');
            //     }
            // });

            $("#DepartmentID").change(function () {
                var orgID = $(this).val();
                if (orgID) {
                    $.ajax({
                        url: '@Url.Action("GetHostByDepartmentID", "Visitor")',
                        type: "POST",
                        data: { id: orgID },
                        success: function (data) {
                            $("#HostID").empty().append('<option value="">Select Host</option>');
                            $.each(data, function (i, v) {
                                $("#HostID").append('<option value="' + v.hostID + '">' + v.hostName + '</option>');
                            });
                        },
                        error: function (xhr, status, error) {
                            console.error("Error fetching hosts: " + error);
                        }
                    });
                } else {
                    $("#HostID").empty().append('<option value="">Select Host</option>');
                }
            });

            $("#UserID").change(function () {
                var userID = $(this).val();
                if (userID) {
                    $.ajax({
                        url: '@Url.Action("LoadUser", "Visitor")',
                        type: "GET",
                        data: { id: userID },
                        success: function (user) {
                            if (user) {
                                $(".user-name").text(user.userName);
                                $(".user-age").text(user.age);
                                $(".user-email").text(user.email);
                                $(".user-mobile").text(user.mobileNo);
                                $(".user-gender").text(user.gender);
                                $(".user-city").text(user.city);
                                // $(".user-joining-date").text(user.joiningDate);
                                $(".user-joining-date").text(formatDateTime(user.joiningDate));


                                // Set the image source dynamically
                                console.log("Img = "+user.imagePath);
                                console.log("mobile = "+user.mobileNo);
                                if (user.imagePath && user.imagePath.trim() !== "") {
                                    $("#userImage").attr("src", user.imagePath);
                                } else {
                                    $("#userImage").attr("src", "https://res.cloudinary.com/diocmz77e/image/upload/v1739631082/profile_zwbuxy.jpg");
                                }

                            } else {
                                clearUserDetails();
                            }
                        },
                        error: function (xhr, status, error) {
                            console.error("Error fetching user details: " + error);
                            clearUserDetails();
                        }
                    });
                } else {
                    clearUserDetails();
                }
            });

                function formatDateTime(dateString) {
            let date = new Date(dateString);
            let options = {day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true };
            return date.toLocaleTimeString('en-US', options); // Converts to 12-hour format with AM/PM
        }

            // Function to clear user details
            function clearUserDetails() {
                $(".user-name, .user-age, .user-email, .user-mobile, .user-gender, .user-city, .user-joining-date").text("-");
            }

        });
    </script>
}